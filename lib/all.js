let mammamia = [[2692,"5","3"],[2890,"1","3"],[3087,"1","1"],[4271,"5","1"],[4666,"1","3"],[5061,"1","1"],[5456,"1","3"],[5653,"1","1"],[5850,"1","1"],[6245,"1","3"],[7035,"5","3"],[7232,"1","1"],[7429,"1","1"],[7824,"1","3"],[10094,"5","1"],[10390,"1","1"],[10785,"1","3"],[10982,"1","3"],[11771,"1","3"],[12166,"1","3"],[12363,"1","1"],[12956,"5","1"],[13153,"1","1"],[13548,"1","1"],[13745,"1","1"],[13942,"1","1"],[14140,"1","3"],[14337,"1","1"],[14929,"1","3"],[15127,"1","3"],[15324,"1","3"],[15719,"1","3"],[15916,"1","3"],[16113,"5","1"],[16508,"1","1"],[17495,"1","1"],[18087,"1","1"],[19469,"5","1"],[19666,"1","3"],[19863,"1","3"],[20061,"1","1"],[21048,"1","1"],[24798,"5","1"],[24995,"1","1"],[25587,"5","1"],[25982,"1","3"],[26377,"1","1"],[26771,"1","3"],[27561,"1","3"],[27758,"1","1"],[30324,"5","1"],[30719,"1","1"],[31113,"1","1"],[32495,"5","1"],[32692,"1","1"],[33285,"1","1"],[34271,"1","3"],[34666,"1","3"],[34863,"1","1"],[35456,"5","1"],[35850,"1","3"],[36048,"1","3"],[36640,"1","1"],[36837,"1","1"],[37035,"1","1"],[37429,"1","1"],[37627,"1","3"],[39008,"5","1"],[39403,"1","1"],[39798,"1","1"],[40192,"1","1"],[40390,"1","1"],[40587,"1","1"],[41771,"5","3"],[42166,"1","1"],[42363,"1","3"],[42758,"1","3"],[42956,"1","2"],[43350,"1","1"],[43745,"1","3"],[44140,"1","1"],[44535,"5","1"],[45324,"1","1"],[45719,"1","1"],[46508,"1","1"],[46706,"1","3"],[46903,"1","1"],[47298,"1","3"],[48087,"5","1"],[48877,"1","3"],[49666,"1","1"],[50061,"1","3"],[50456,"1","3"],[50653,"1","3"],[51245,"5","3"],[51442,"1","1"],[51640,"1","3"],[52035,"1","3"],[52824,"1","1"],[53021,"1","1"],[53613,"1","3"],[54008,"5","1"],[56179,"1","1"],[56969,"1","1"],[57561,"5","3"],[58153,"1","1"],[58350,"1","3"],[59140,"1","1"],[59337,"1","1"],[59732,"1","1"],[59929,"1","1"],[60127,"1","1"],[60719,"5","1"],[61113,"1","3"],[61508,"1","1"],[63087,"1","3"],[63877,"5","3"],[64074,"1","3"],[64469,"1","3"],[64666,"1","3"],[65456,"1","3"],[65653,"1","1"],[66048,"1","1"],[66245,"1","1"],[66442,"1","1"],[66640,"5","2"],[67232,"1","3"],[67824,"1","3"],[68416,"1","1"],[68613,"1","1"],[68811,"1","1"],[69008,"1","3"],[69206,"1","1"],[69600,"1","3"],[70390,"5","1"],[70785,"1","1"],[70982,"1","1"],[72166,"1","1"],[72363,"1","1"],[73942,"5","3"],[74140,"1","1"],[74929,"1","1"],[75324,"1","1"],[76113,"5","3"],[76706,"1","3"],[76903,"1","1"],[77100,"1","3"],[77298,"1","1"],[77495,"1","3"],[77692,"1","3"],[78087,"1","3"],[78285,"1","1"],[78482,"1","1"],[78679,"1","1"],[78877,"1","3"],[79074,"1","1"],[79666,"5","1"],[80850,"1","1"],[81048,"1","1"],[81245,"1","1"],[81640,"1","1"],[82035,"1","1"]];
let trauma = [[306,"5","3"],[847,"5","3"],[1387,"1","1"],[1657,"1","3"],[2333,"1","3"],[2738,"1","1"],[3414,"1","1"],[5711,"5","1"],[5982,"1","1"],[6657,"1","3"],[7063,"1","1"],[8414,"1","3"],[9495,"5","1"],[10306,"1","1"],[10576,"1","1"],[10847,"1","3"],[11657,"1","3"],[12738,"1","3"],[13820,"5","1"],[14360,"1","2"],[14630,"1","3"],[14901,"1","1"],[15441,"1","1"],[15982,"1","1"],[16522,"1","1"],[16792,"1","2"],[17063,"1","3"],[17603,"5","1"],[17874,"1","1"],[18144,"1","3"],[18684,"1","3"],[19225,"1","3"],[20306,"1","1"],[20847,"1","1"],[21117,"1","1"],[21387,"1","4"],[22198,"5","1"],[22468,"1","3"],[22738,"1","1"],[23009,"1","1"],[23549,"1","3"],[24630,"1","3"],[25171,"1","3"],[26252,"5","3"],[26522,"1","3"],[27333,"1","3"],[29765,"1","1"],[31657,"5","1"],[31928,"1","1"],[32063,"1","1"],[32198,"1","3"],[33009,"1","1"],[33549,"1","1"],[34360,"1","1"],[34630,"1","1"],[35171,"5","1"],[35306,"1","1"],[35576,"1","1"],[35982,"1","1"],[36117,"1","1"],[36387,"1","1"],[36522,"1","1"],[36792,"1","1"],[36928,"1","1"],[37063,"1","1"],[37333,"1","1"],[37874,"1","3"],[38144,"1","3"],[38549,"1","1"],[38684,"1","3"],[38955,"1","3"],[39225,"5","1"],[39495,"1","3"],[39630,"1","1"],[40036,"1","1"],[40306,"1","3"],[40441,"1","1"],[40711,"1","1"],[41117,"1","1"],[42603,"1","1"],[43009,"1","1"],[44901,"5","1"],[46252,"1","3"],[47333,"1","1"],[47874,"5","1"],[50036,"1","3"],[50982,"1","1"],[51117,"1","4"],[51657,"1","1"],[53279,"5","1"],[54360,"1","3"],[54901,"1","1"],[55441,"1","1"],[57063,"5","1"],[57333,"1","3"],[57468,"1","1"],[58144,"1","1"],[58414,"1","1"],[59225,"1","3"],[59901,"1","1"],[60171,"1","1"],[60306,"1","1"],[61387,"5","3"],[61657,"1","1"],[61928,"1","3"],[63009,"1","3"],[63549,"1","3"],[63820,"1","1"],[64090,"1","3"],[66792,"5","3"],[67333,"1","1"],[67874,"1","1"],[68144,"1","3"],[68414,"1","3"],[68955,"1","1"],[69495,"5","3"],[70036,"1","3"],[70576,"1","3"],[71117,"1","1"],[71387,"1","3"],[71657,"1","1"],[72738,"1","3"],[74090,"5","1"],[74360,"1","3"],[74630,"1","1"],[75441,"1","3"],[75711,"1","3"],[76792,"1","1"],[77333,"1","1"],[77603,"1","1"]];
let mySea = [[3032,"5","1"],[6983,"1","1"],[7861,"1","3"],[10494,"1","1"],[10933,"1","3"],[11153,"1","1"],[11811,"1","1"],[14006,"1","1"],[16640,"1","1"],[16860,"1","3"],[17079,"1","1"],[18506,"1","1"],[18725,"1","1"],[18945,"1","3"],[21249,"1","1"],[21688,"1","1"],[21908,"1","3"],[22347,"1","3"],[22566,"1","1"],[24761,"1","1"],[25200,"1","1"],[25420,"1","1"],[27505,"1","3"],[27944,"1","1"],[31785,"1","1"],[32005,"1","1"],[32224,"1","1"],[32443,"1","3"],[33651,"1","1"],[33870,"1","1"],[34090,"1","1"],[34309,"1","3"],[34748,"1","1"],[35187,"1","3"],[35407,"1","1"],[35626,"1","1"],[35846,"1","1"],[36065,"1","3"],[38918,"1","1"],[39138,"1","1"],[39357,"1","1"],[39577,"1","3"],[40674,"1","1"],[40894,"1","1"],[41113,"1","3"],[41333,"1","1"],[41772,"1","3"],[42430,"1","3"],[42869,"1","1"],[46052,"1","1"],[46271,"1","3"],[46491,"1","1"],[46710,"1","3"],[47808,"1","1"],[48027,"1","3"],[48247,"1","1"],[48466,"1","3"],[48905,"1","1"],[49344,"1","3"],[49564,"1","1"],[49783,"1","3"],[50003,"1","1"],[50222,"1","3"],[51429,"1","1"],[51649,"1","1"],[51868,"1","3"],[52088,"1","3"],[52746,"1","3"],[52966,"1","1"],[53185,"1","3"],[54173,"1","1"],[54832,"1","1"],[55380,"1","3"],[55600,"1","1"],[56039,"1","1"],[56587,"1","3"],[57026,"1","3"],[59441,"1","1"],[59660,"1","1"],[59880,"1","1"],[61197,"1","1"],[61416,"1","1"],[61636,"1","3"],[62953,"1","3"],[63282,"1","3"],[63611,"1","3"],[66465,"1","1"],[66684,"1","1"],[66904,"1","3"],[67233,"1","1"],[67891,"1","3"],[68220,"1","1"],[68659,"1","1"],[69098,"1","1"],[69647,"1","3"],[69976,"1","1"],[70306,"1","1"],[70635,"1","1"]];
let onAndOn = [[3480,"5","1"],[4230,"1","1"],[4980,"1","1"],[5355,"1","1"],[5730,"1","3"],[6573,"1","1"],[7323,"1","1"],[7980,"1","1"],[8730,"5","1"],[9480,"1","1"],[10230,"5","1"],[10980,"1","1"],[11355,"1","1"],[11730,"1","1"],[11918,"1","3"],[12480,"5","1"],[13230,"1","3"],[13980,"1","3"],[14355,"1","1"],[14730,"1","3"],[15480,"1","3"],[16042,"1","1"],[16417,"1","1"],[16980,"5","3"],[18105,"1","1"],[18292,"1","1"],[18480,"1","3"],[18948,"1","1"],[19136,"1","1"],[19323,"1","1"],[19980,"1","1"],[20355,"1","1"],[20636,"1","1"],[21480,"1","1"],[21855,"1","1"],[22980,"1","1"],[23355,"1","3"],[23730,"1","1"],[24480,"5","1"],[24667,"1","1"],[24855,"1","1"],[25042,"1","1"],[25980,"1","1"],[26167,"1","1"],[26355,"1","3"],[27292,"1","3"],[27480,"1","1"],[27667,"1","1"],[28042,"1","1"],[28230,"1","3"],[28980,"5","2"],[29167,"1","1"],[29355,"1","1"],[29542,"1","1"],[29730,"1","3"],[30386,"1","1"],[30573,"1","1"],[30855,"1","1"],[31042,"1","1"],[31792,"1","1"],[32073,"1","1"],[32355,"1","1"],[33480,"5","1"],[34605,"1","1"],[34698,"1","1"],[34980,"1","1"],[35168,"1","1"],[35355,"1","3"],[36480,"5","1"],[36855,"1","1"],[37042,"1","1"],[37418,"1","3"],[37980,"1","1"],[38355,"1","1"],[38542,"1","1"],[38917,"1","3"],[39480,"5","3"],[41448,"1","3"],[42011,"5","1"],[42198,"1","1"],[42480,"1","1"],[42667,"1","1"],[43792,"1","3"],[43980,"1","3"],[44167,"1","3"],[45105,"5","1"],[45480,"1","3"],[45855,"1","1"],[46230,"1","3"],[46605,"1","1"],[46792,"1","1"],[46980,"1","3"],[47542,"1","1"],[47730,"1","1"],[47917,"5","1"],[48480,"1","3"],[49230,"1","1"],[50355,"1","1"],[50730,"1","3"],[51480,"1","1"],[52230,"1","1"],[53823,"1","1"],[54198,"5","1"],[54573,"5","3"],[55230,"1","1"],[55418,"1","1"],[55792,"1","1"],[56355,"1","3"],[56730,"1","1"],[57386,"5","1"],[58230,"1","3"],[58792,"1","1"],[59167,"1","1"],[59448,"1","1"],[60105,"5","1"],[60292,"1","1"],[60855,"1","1"],[61230,"1","3"],[61605,"1","1"],[61792,"1","3"],[62730,"1","3"],[63292,"5","1"],[63480,"1","3"],[63855,"1","1"],[64230,"1","3"],[65355,"1","1"],[65730,"1","1"],[65918,"1","1"],[66011,"1","1"],[66292,"5","1"],[66480,"1","1"],[66855,"1","1"],[67042,"1","1"],[67230,"1","1"],[67418,"1","1"],[67792,"1","1"],[67980,"1","1"],[68355,"1","1"],[68730,"1","3"],[68918,"1","1"],[69480,"5","3"],[69855,"1","1"],[70230,"1","1"],[70980,"1","1"],[71355,"1","1"],[71730,"1","3"],[71918,"1","1"],[72105,"5","1"],[72480,"1","1"],[72668,"1","1"],[72855,"1","1"],[73230,"1","1"],[73980,"1","3"],[74355,"1","3"],[74542,"1","3"],[74730,"1","1"],[74918,"1","1"],[75480,"5","1"],[76510,"1","1"],[76697,"1","3"],[76885,"1","1"],[77073,"1","3"]];
let savior = [[5002,"5","1"],[5407,"1","1"],[6623,"5","1"],[8042,"1","1"],[8549,"1","1"],[8752,"1","1"],[9157,"1","1"],[9867,"5","3"],[10272,"1","3"],[11894,"1","3"],[12299,"1","1"],[12502,"1","1"],[12907,"1","1"],[14732,"5","1"],[15036,"1","1"],[15137,"1","1"],[15542,"1","1"],[16049,"1","1"],[16252,"1","1"],[16759,"5","1"],[17164,"1","1"],[17367,"1","3"],[17569,"1","1"],[17772,"1","3"],[18482,"1","3"],[18887,"1","3"],[19596,"5","1"],[20002,"1","3"],[20205,"1","1"],[21117,"1","1"],[21218,"1","1"],[22232,"1","1"],[22434,"1","1"],[24867,"5","3"],[25272,"1","1"],[25475,"1","1"],[25982,"1","3"],[27502,"5","1"],[27705,"1","1"],[29529,"5","1"],[29732,"1","3"],[29934,"1","3"],[30542,"1","3"],[30745,"1","1"],[31049,"1","1"],[31252,"1","3"],[32164,"1","1"],[32367,"1","1"],[32569,"5","3"],[32975,"1","3"],[33380,"1","3"],[33684,"1","3"],[33887,"1","1"],[34090,"1","1"],[34596,"1","1"],[34799,"1","1"],[35002,"1","1"],[35610,"1","1"],[36826,"5","3"],[37029,"1","1"],[38346,"1","1"],[38752,"1","1"],[38853,"1","1"],[39461,"5","1"],[40069,"1","3"],[40272,"1","1"],[40678,"1","1"],[41184,"1","1"],[41387,"1","1"],[42096,"1","1"],[42502,"5","1"],[43110,"1","1"],[43515,"1","3"],[44732,"1","3"],[45745,"5","3"],[46759,"1","1"],[47975,"1","3"],[48482,"1","1"],[50407,"5","1"],[51117,"1","1"],[52232,"5","3"],[52434,"1","1"],[52637,"1","3"],[52840,"1","3"],[53346,"1","1"],[53549,"1","1"],[53651,"1","3"],[54056,"1","3"],[54461,"1","1"],[54867,"1","3"],[55069,"1","1"],[55475,"5","1"],[56184,"1","1"],[58515,"5","1"],[59732,"1","1"],[59934,"1","4"],[60137,"1","1"],[61252,"1","1"],[62569,"5","1"],[62772,"1","1"],[62975,"1","3"],[63482,"1","1"],[65002,"5","2"],[65610,"1","1"],[65914,"1","1"],[66522,"1","1"],[67130,"1","1"],[68245,"5","1"],[68752,"1","1"],[69157,"1","1"],[69867,"1","1"],[70069,"1","1"],[70272,"1","3"],[70880,"1","1"],[71894,"5","3"],[72502,"1","3"],[72705,"1","3"],[74732,"5","1"],[74934,"1","1"],[75137,"1","1"],[75542,"1","1"],[76049,"1","4"],[76759,"1","3"],[76961,"1","1"],[77164,"1","1"],[77367,"1","1"],[77569,"1","3"],[77772,"1","3"],[78482,"5","1"],[78887,"1","3"],[79090,"1","1"],[79596,"1","3"],[80002,"1","1"],[80407,"1","3"],[80813,"1","1"],[81117,"1","1"],[81218,"5","1"],[81826,"1","1"],[82029,"1","1"],[82434,"1","3"],[82637,"1","3"],[82840,"1","1"],[83245,"1","1"],[83752,"1","1"],[84867,"5","1"],[85272,"1","1"],[85678,"1","1"],[86184,"1","1"],[86387,"1","1"],[86590,"1","1"],[88110,"5","1"],[89732,"1","1"],[89934,"1","1"],[90137,"1","1"],[90542,"1","1"],[91455,"5","1"],[92367,"1","3"],[92975,"1","3"],[94090,"1","1"],[95002,"5","3"],[95205,"1","1"],[95407,"1","1"],[97029,"1","1"],[97232,"1","3"],[97840,"5","1"],[99461,"1","4"],[99867,"1","1"],[100272,"1","1"],[100982,"5","1"],[101184,"1","1"],[102502,"1","1"],[102907,"1","1"],[103110,"1","3"],[103617,"1","1"],[104732,"5","1"],[105137,"1","3"],[105340,"1","1"],[106252,"1","3"],[107367,"5","3"],[107569,"1","1"],[108279,"1","1"],[108887,"1","1"],[110002,"1","3"],[110205,"1","1"],[111319,"5","1"],[111522,"1","1"],[112029,"1","1"],[112232,"1","3"],[112434,"1","3"],[112637,"1","3"],[113346,"1","1"],[113651,"5","1"],[113853,"1","1"],[114056,"1","3"],[114360,"1","1"],[114461,"1","3"],[114867,"1","3"],[115272,"1","3"],[116590,"1","1"],[116894,"5","1"],[117401,"1","1"],[118515,"1","1"],[119326,"1","3"],[119732,"1","1"],[120137,"5","1"],[121252,"1","1"],[121455,"1","1"],[122569,"1","1"],[122975,"1","1"],[123482,"5","1"],[125002,"1","3"],[125205,"1","1"],[125610,"1","1"],[125813,"1","3"],[125914,"1","1"],[126319,"1","1"],[127130,"5","1"],[128245,"1","1"],[128448,"1","1"],[128651,"1","1"],[130272,"5","1"],[130678,"1","1"],[130880,"1","1"],[132502,"1","4"],[132705,"1","1"],[134732,"5","4"],[134934,"1","1"],[135542,"1","3"],[137367,"5","1"],[138887,"1","1"],[139495,"1","1"],[139596,"5","1"],[140002,"1","1"],[140205,"1","1"],[141117,"1","1"],[141319,"1","1"],[141928,"1","1"],[142130,"1","1"],[142232,"1","1"],[142434,"1","1"],[143651,"5","1"],[143752,"1","3"],[144461,"1","1"],[144867,"1","3"],[145272,"1","2"],[145475,"1","1"],[145576,"1","1"],[145779,"1","1"],[146184,"5","1"],[146894,"1","1"],[147096,"1","1"],[147299,"1","3"],[147705,"1","1"],[148617,"1","1"],[149934,"5","1"],[150340,"1","1"],[150542,"1","1"],[150745,"1","1"],[152164,"1","3"],[152367,"1","3"],[152772,"5","1"],[153482,"1","3"],[154090,"1","1"],[155002,"1","3"],[155914,"5","1"],[157130,"1","1"],[157434,"1","1"],[157840,"1","3"],[158245,"1","1"],[158853,"1","1"],[159461,"5","3"],[159867,"1","1"],[160069,"1","1"],[160475,"1","3"],[161894,"1","1"],[162096,"1","1"],[162299,"5","4"],[163211,"1","1"],[163921,"1","3"],[164326,"1","3"],[164732,"1","3"],[164934,"1","1"],[165137,"1","3"],[165340,"1","1"],[165542,"5","2"],[165745,"1","1"],[166657,"1","1"],[166759,"1","1"],[167367,"1","1"],[167569,"1","3"],[167975,"1","1"],[168583,"1","3"],[168684,"1","1"],[169090,"5","1"],[169698,"1","1"],[169901,"1","1"],[170002,"1","1"],[171319,"1","3"],[171725,"1","1"],[172029,"5","1"],[172232,"1","3"],[172434,"1","1"],[172637,"1","4"],[173448,"1","3"],[173651,"1","1"],[173752,"1","1"],[174664,"1","1"],[174867,"1","3"],[175069,"1","3"],[175272,"5","1"],[175982,"1","1"],[176387,"1","3"],[176894,"1","1"],[177299,"1","1"],[177705,"1","1"],[178110,"1","1"],[178617,"5","1"],[179732,"1","1"],[180340,"1","1"],[180542,"1","3"],[180745,"1","1"],[180948,"1","3"],[181151,"1","1"],[181353,"1","3"],[181657,"1","1"],[182367,"5","1"],[182569,"1","1"],[182772,"1","3"],[183380,"1","1"],[183583,"1","1"],[184394,"1","1"],[184799,"1","1"],[185002,"5","3"],[185205,"1","1"],[186826,"1","1"],[187232,"1","1"],[187434,"1","1"],[187840,"1","1"],[188042,"1","1"],[193515,"5","1"],[194022,"1","1"],[194732,"5","1"],[196759,"1","1"],[198482,"5","1"],[200407,"1","3"],[201319,"5","1"]];
let echo = [[4254,"5","3"],[4654,"1","1"],[6654,"5","3"],[7254,"1","3"],[8754,"1","2"],[9154,"1","3"],[10254,"5","1"],[11754,"1","1"],[13254,"5","1"],[13654,"1","1"],[13954,"1","1"],[14354,"1","1"],[14754,"1","1"],[15054,"1","3"],[15854,"1","3"],[16054,"1","3"],[16254,"5","3"],[16654,"1","3"],[17754,"1","1"],[18254,"1","3"],[18454,"1","1"],[18854,"1","1"],[19054,"1","3"],[19254,"1","1"],[19454,"5","1"],[22254,"1","3"],[22454,"1","1"],[22954,"5","1"],[24854,"1","1"],[25254,"1","3"],[25754,"1","1"],[25954,"5","1"],[27854,"1","3"],[28054,"1","1"],[28254,"1","1"],[28654,"1","3"],[29354,"1","1"],[30454,"1","1"],[31054,"1","3"],[31254,"1","3"],[31454,"1","1"],[32354,"5","1"],[33354,"1","1"],[33854,"1","3"],[34054,"1","1"],[34254,"1","3"],[34454,"1","1"],[34654,"1","1"],[34854,"1","1"],[35454,"5","1"],[35854,"1","1"],[36254,"1","1"],[36454,"1","1"],[36654,"1","3"],[37254,"1","1"],[38354,"1","1"],[38654,"5","1"],[38854,"1","1"],[39454,"1","1"],[39854,"1","1"],[40054,"1","1"],[40254,"1","1"],[40654,"1","1"],[41054,"1","1"],[42454,"5","4"],[42854,"1","1"],[43054,"1","1"],[43254,"1","1"],[43454,"1","3"],[43854,"1","3"],[44754,"1","3"],[45854,"5","1"],[46254,"1","1"],[46654,"1","1"],[46854,"1","1"],[47054,"1","3"],[48154,"1","1"],[49054,"5","3"],[49254,"1","1"],[49654,"1","1"],[50354,"1","1"],[50754,"1","1"],[51854,"5","1"],[52054,"1","1"],[52254,"1","3"],[52454,"1","1"],[53354,"1","1"],[53554,"1","1"],[53654,"1","1"],[54454,"1","1"],[54854,"5","1"],[55254,"1","1"],[55454,"1","1"],[55854,"1","1"],[56354,"1","1"],[56754,"1","1"],[57854,"5","1"],[58254,"1","3"],[58654,"1","1"],[61254,"5","3"],[61454,"1","1"],[61654,"1","1"],[61854,"1","3"],[62254,"1","1"],[63854,"1","1"],[64254,"5","1"],[64854,"1","3"],[65054,"1","3"],[66854,"1","1"],[67254,"1","3"],[67754,"5","1"],[68154,"1","1"],[68354,"1","1"],[69854,"1","3"],[70054,"1","1"],[70254,"1","3"],[70454,"1","3"],[70654,"5","3"],[70854,"1","1"],[71254,"1","1"],[71454,"1","1"],[72254,"1","3"],[72454,"1","3"],[72854,"1","1"],[73254,"1","3"],[73854,"5","1"],[74254,"1","4"],[74554,"1","1"],[75854,"1","3"],[76054,"1","1"],[76254,"1","1"],[76454,"1","1"],[76654,"1","3"],[77054,"5","1"]];


let notes = {};
let time_on_screen = 1500;
class Combo {
  constructor() {
    this.combo = 0;
    this.stage = document.getElementById('canvas').getContext('2d');
    this.counter = document.getElementById('combo');
    this.maxCombo = 0;
    this.combostring = "0";
    this.numimage = new Image();
    this.numimage.src = `./gifs/numbers.png`;
  }

  render() {
    for (let i=0; i<this.combostring.length; i++) {
      let num = parseInt(this.combostring.charAt(i));
      this.stage.drawImage(this.numimage, num * 40, 0, 40, 40, 40+ 30*i, 143, 30, 30);
    }
  }

  show() {
    this.counter.classList.remove('bounceOutRight');
    this.counter.classList.add('bounceInRight');
  }

  hide() {
    this.counter.classList.remove('bounceInRight');
    this.counter.classList.add('bounceOutRight');
  }

  up() {
    this.combo ++;
    this.show();
    if (this.combo > this.maxCombo) {
      this.maxCombo = this.combo;
    }
    this.combostring = this.combo.toString();
  }

  reset() {
    this.combo = 0;
    this.combostring = this.combo.toString();
    this.hide();
  }
}

class Drum {
  constructor() {
    this.stage = document.getElementById('canvas').getContext('2d');
    this.x = 214;
    this.y = 224;
    this.colorRim = 'white';
    this.colorCenter = 'lightgrey';
  }

  render() {
    this.drawCircle(31, this.colorRim);
    this.drawCircle(20, this.colorCenter);
  }

  tap(note) {
    if (note.id === 'kat') {
      this.colorRim = 'skyblue';
    } else {
      this.colorCenter = 'orangered';
    }

    setTimeout(() => {
      this.colorRim = 'white';
      this.colorCenter = 'lightgrey';
    }, 100);
  }

  drawCircle(radius, color) {
    let stage = this.stage;
    stage.beginPath();
    stage.arc(this.x, this.y, radius, 0, 2 * Math.PI);
    stage.fillStyle = color;
    stage.fill();
  }

  flash() {
    // let stage = this.stage;
    // stage.beginPath();
    // stage.fillStyle = '#ffe92b';
    // stage.fillRect(150, 150, 80, 160);
  }
}

class DrumKey {
  constructor(drum, key) {
    this.drum = drum;
    this.key = key;
  }

  register(note) {
    this.type = note.id;

    document.addEventListener('keydown', e => {
      if (this.key === e.key) {
        this.pressed = true;
        note.currentTime = 0;
        note.play();
        this.drum.tap(note);
        setTimeout(() => {
          this.pressed = false;
        }, 100)
      }
      let notesKeys = Object.keys(notes);
      for (let i = 0; i < notesKeys.length; i++) {
        let id = notesKeys[i];
        let note = notes[id];
  
        if (note.x > this.drum.x - 60 && note.x < this.drum.x) {
          for (let j = 0; j < drumKeys.length; j++) {
            let key = drumKeys[j];
            if (key.pressed) {
              key.pressed = false;
              // drum.flash();
              if (key.type === note.type) {
                combo.up();
                spiritGauge.up(combo.combo);
                score.up(spiritGauge.spirit);
                delete notes[id];
              } else {
                console.log("miss")
                combo.reset();
              }
            }
          }
        }
        if (note.x > this.drum.x){
          break;
        }
      }
    });

    document.addEventListener('keyup', e => {
      if (this.key === e.key.toLowerCase()) {
        this.pressed = false;
      }
    });
  }
}
class TaikoInseong {
  constructor(song){
    this.state = "neutral"
    this.updateTimer = 0
    this.x = 648;
    this.y = 17;
    this.image = new Image();
    this.stage = document.getElementById('canvas').getContext('2d');
    this.song = song;
  }
  updateState(state, timer){
    this.state = state
    this.updateTimer = timer
  }
  render(){
      this.image.src = `./gifs/${this.song}/${this.state}.png`;
      this.stage.drawImage(this.image, this.x, this.y);
  }
}
class Note {
  constructor(vel, color, type,time) {
    this.x = 800;
    this.y = 195;
    this.vel = vel;
    this.id = Date.now();
    this.color = color;
    this.type = type;
    this.time = time;

    this.image = new Image();
    this.image.src = `./gifs/${color}_chestnut_note_500.png`;

    this.stage = document.getElementById('canvas').getContext('2d');
  }

  move(timer) {
    this.x = Math.floor(((this.time-timer)/time_on_screen)*566+234);
  }

  render() {
    this.stage.drawImage(this.image, this.x, this.y);
  }
}

class Score {
  constructor(song) {
    this.stage = document.getElementById('canvas').getContext('2d');
    this.score = 0;
    this.scorestring = "0";
    this.numimage = new Image();
    this.numimage.src = `./gifs/numbers.png`;

  }

  render() {
    for (let i=0; i<this.scorestring.length; i++) {
      let num = parseInt(this.scorestring.charAt(i));
      this.stage.drawImage(this.numimage, num * 40, 0, 40, 40, 440+ 30*i, 150, 30, 30);
    }
  }

  up(spirit) {
    let multiplier = spirit / 100;
    let score = Math.floor(100 * multiplier + 100);
    this.score += score;
    this.scorestring = this.score.toString();
  }
}

class SpiritGauge {
  constructor() {
    this.x = 340;
    this.y = 67;
    this.stage = document.getElementById('canvas').getContext('2d');
    this.spirit = 0;
    this.maxSpirit = 1000;
    this.maxWidth = 400;
  }

  render() {
    let stage = this.stage;
    stage.beginPath();
    stage.rect(this.x, this.y, this.maxWidth, 40);
    stage.fillStyle = 'white';
    stage.fillRect(this.x, this.y, this.maxWidth, 40);
    stage.lineWidth = 3;
    stage.strokeStyle = 'black';
    stage.stroke();

    this.bar();
    this.lit();
  }

  up(combo) {
    if (this.spirit < this.maxSpirit) {
      let spirit = 1 + combo;
      this.spirit += spirit;
    }
  }

  down() {
    if (this.spirit > 0) {
      this.spirit --;
    }
  }

  bar() {
    let width = this.spirit / this.maxSpirit * this.maxWidth;
    if (width >= this.maxWidth) {
      width = this.maxWidth;
      this.full = true;
    } else {
      this.full = false;
    }
    this.stage.fillStyle = '#ffe92b';
    this.stage.fillRect(this.x + 3, this.y + 3, width, 34);
  }

  lit() {
    let fire = document.getElementById('fire');
    if (this.full) {
      fire.classList.remove('hide');
    } else {
      fire.classList.add('hide');
    }
  }
}

class ToggleMusic {
  constructor(music) {
    this.music = music;
    this.volumeOn = document.getElementById('volume-on');
    this.volumeOff = document.getElementById('volume-off');
    this.musicMute = document.querySelector('.music-mute');
    this.init();
  }

  init() {
    this.musicMute.addEventListener('click', e => this.render());
    document.addEventListener('keypress', e => {
      if (e.code === 'KeyM') {
        this.render();
      }
    });
  }

  render() {
    this.music.muted = this.music.muted ? false : true;
    this.volumeOn.classList.toggle('hide', this.music.muted);
    this.volumeOff.classList.toggle('hide', !this.music.muted);
  }
}

class TogglePlay {
  constructor() {
    this.gameOn = false;
    this.play = document.getElementById('play');
    this.pause = document.getElementById('pause');
  }

  render() {
    this.gameOn = this.gameOn ? false : true;
    this.play.classList.toggle('hide', this.gameOn);
    this.pause.classList.toggle('hide', !this.gameOn);
  }
}

const buttonPositions = {
  bluearea1: {
    x: 0,
    y: 273,
    width: 250,
    height: 200
  },
  bluearea2: {
    x: 530,
    y: 273,
    width: 270,
    height: 200
  },
  pinkarea: {
    x: 270,
    y: 273,
    width: 250,
    height: 200
  },
  playagain: {
    x: 225,
    y: 335,
    width: 160,
    height: 30
  },
  selectsong: {
    x: 415,
    y: 335,
    width: 160,
    height: 30
  },
  backdoor: {
    x: 80,
    y: 165,
    width: 240,
    height: 50
  },
  mysea: {
    x: 485,
    y: 165,
    width: 240,
    height: 50
  },
  echo: {
    x: 80,
    y: 235,
    width: 240,
    height: 50
  },
  onandon: {
    x: 485,
    y: 235,
    width: 240,
    height: 50
  },
  icantstop: {
    x: 80,
    y: 310,
    width: 240,
    height: 50
  },
  savior: {
    x: 485,
    y: 310,
    width: 240,
    height: 50
  },
  mammamia: {
    x: 80,
    y: 380,
    width: 240,
    height: 50
  },
  trauma: {
    x: 485,
    y: 380,
    width: 240,
    height: 50
  },
};

function isInside(pos, rect, desc){
  return pos.x > rect.x && pos.x < rect.x+rect.width && pos.y < rect.y+rect.height && pos.y > rect.y
}

// Get the mouse position
function getMousePos(canvas, e) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: Math.round((e.clientX - rect.left)/(rect.right - rect.left)*canvas.width),
        y: Math.round((e.clientY - rect.top)/(rect.bottom - rect.top)*canvas.height)
    };
}




document.addEventListener('DOMContentLoaded', () => {
  function preventDefault(e){
    e.preventDefault();
  }

  function disableScroll(){
      document.body.addEventListener('touchmove', preventDefault, { passive: false });
  }


  const mammamiaAudio = document.createElement('audio');
  mammamiaAudio.src = "./sounds/MammaMia.mp3";
  mammamiaAudio.bpm = 152;
  const traumaAudio = document.createElement('audio');
  traumaAudio.src = "./sounds/trauma.mp3";
  traumaAudio.bpm = 112;
  const mySeaAudio = document.createElement('audio');
  mySeaAudio.src = "./sounds/mysea.mp3";
  mySeaAudio.bpm = 68;
  const echoAudio = document.createElement('audio');
  echoAudio.src = "./sounds/echo.mp3";
  const saviorAudio = document.createElement('audio');
  saviorAudio.src = "./sounds/savior.mp3";
  const onAndOnAudio = document.createElement('audio');
  onAndOnAudio.src = "./sounds/onAndOn.mp3";

  const don = new Audio();
  const kat = new Audio();
  don.id = 'don';
  kat.id = 'kat';
  don.src = './sounds/don.mp3';
  kat.src = './sounds/kat.mp3';
  let songid = ["MammaMia","Trauma","MySea","Echo","Savior","OnAndOn"]
  let songLib = {"MammaMia":mammamiaAudio,
    "Trauma":traumaAudio,
    "MySea": mySeaAudio,
    "Echo": echoAudio,
    "Savior": saviorAudio,
    "OnAndOn": onAndOnAudio
  };
  let songNotes = {"MammaMia":mammamia,
  "Trauma":trauma,
  "MySea": mySea,
  "Echo": echo,
  "Savior": savior,
  "OnAndOn": onAndOn};
  // let songNum = Math.floor(Math.random() * songid.length);
  let gameSelection = false;
  let gameOn = false;
  let gameEnded = false;
  let selectedSong = "echo";
  let gifs = document.getElementsByClassName("gif");
  const canvas = document.getElementById('canvas');
  // let songNum = 1;
  // console.log(songid,songLib,songLib["MammaMia"])
  // let music = songLib[songid[songNum]];
  // music.volume = 0.5;
  // let clearTouch = false;
  // let touchSetTime = 0;

  // const toggleMusic = new ToggleMusic(music);
  // const togglePlay = new TogglePlay();
  // const canvas = document.getElementById('canvas');
  // const stage = canvas.getContext('2d');
  // const score = new Score(songid[songNum]);
  // const spiritGauge = new SpiritGauge();
  // const combo = new Combo();
  let drum = new Drum();
  let taikoInseong, combo, spiritGauge, score;

  var startscreen = document.getElementById("startscreen");
  var startscreencontext = startscreen.getContext("2d");
  canvas.style.display = "none";
  startscreen.style.backgroundImage = "url('./gifs/ArcadeMachine.png')";
  startscreen.style.backgroundPosition = "bottom";
  // document.body.style.backgroundColor = "transparent";
  // document.body.style.backgroundImage = "url('background.png')";
  // let arcadeMachine = new Image();
  // arcadeMachine.src = `./gifs/ArcadeMachine.png`;
  // startscreen.height = document.documentElement.clientHeight;
  // startscreen.width = document.documentElement.clientWidth;
  // machineWidth = 0.675*(document.documentElement.clientHeight*0.85);
  // console.log(machineWidth);
  // startscreencontext.drawImage(arcadeMachine,(document.documentElement.clientWidth/2)-(machineWidth/2),0,machineWidth,document.documentElement.clientHeight);
// startscreencontext.drawImage(arcadeMachine,0,0,machineWidth,document.documentElement.clientHeight);

  // function NotesArea() {
  //   stage.beginPath();
  //   stage.lineWidth = 5;
  //   stage.moveTo(0, 150);
  //   stage.lineTo(800, 150);
  //   stage.stroke();
  //   stage.fillStyle = 'lightgrey';
  //   stage.fillRect(0, 150, 800, 200);
  //   stage.fillStyle = 'black';
  //   stage.fillRect(0, 310, 800, 40);
  //   stage.fill();
  // }

  const keyA = new DrumKey(drum, 'ArrowLeft');
  const keyB = new DrumKey(drum, 'ArrowRight');
  const drumKeys = [keyA, keyB];
  keyA.register(don);
  keyB.register(kat);

 // function togglePause() {
 //    if (!gameEnded && !gameSelection) {
 //      if (musicOn) {
 //        musicOn = false;
 //        pauseStart = Date.now();
 //        music.pause();
 //      } else {
 //        musicOn = true;
 //        // console.log(pauseStart);
 //        // console.log(timePaused);
 //        timePaused = Math.ceil(Date.now()-pauseStart)+timePaused;
 //        // console.log(timePaused)
 //        music.play();
 //      }
 //      togglePlay.render();
  
 //      gameOn = gameOn ? false : true;
 //      update();
 //    }
 //  }

  // On mouse button click
  function onMouseDown(e) {
      // Get the mouse position
      var pos = getMousePos(canvas, e);
      var arcadehit = localStorage.getItem("arcadehit");
      console.log(pos.x, pos.y);
      console.log(gameEnded,gameOn,gameSelection);
      // console.log(e.clientX,e.clientY)
      if (arcadehit != "true") {
        // moving to select screen
        console.log('in local storage')
        canvas.style.display = "block";
        startscreen.style.display = "none";
        gameSelection = true;
        localStorage.setItem("arcadehit","true");
      }
      else if (gameEnded) {
        if (isInside(pos,buttonPositions['playagain'])){
          localStorage.setItem('selectedsong',selectedSong)
          location.reload();
        } else if (isInside(pos,buttonPositions['selectsong'])) {
          location.reload();
        }
      } else if (gameSelection) {
        //let songid = ["MammaMia","Trauma","MySea","Echo","Savior","OnAndOn"]
        if (isInside(pos,buttonPositions['mysea'])) {
          selectSong(songid[2]);
        } else if (isInside(pos,buttonPositions['echo'])) {
          selectSong(songid[3]);
        }else if (isInside(pos,buttonPositions['mammamia'])) {
          selectSong(songid[0]);
        }else if (isInside(pos,buttonPositions['trauma'])) {
          selectSong(songid[1]);
        }else if (isInside(pos,buttonPositions['savior'])) {
          selectSong(songid[4]);
        }else if (isInside(pos,buttonPositions['onandon'])) {
          selectSong(songid[5]);
        }
      }
      else if (isInside(pos,buttonPositions["bluearea1"],"bluearea1") || isInside(pos,buttonPositions["bluearea2"],"bluearea2") ) {
             // console.log("kat")
            keyB.pressed = true;
            kat.currentTime = 0;
            // kat.play();  //seems like these cause lag :( )
            keyB.drum.tap(kat);
            // setTimeout(() => {
            //   keyB.pressed = false;
            // }, 100)
      }
      else if (isInside(pos,buttonPositions["pinkarea"],"pinkarea")) {
            // console.log("don")
            keyA.pressed = true;
            don.currentTime = 0;
            // don.play(); //seems like these cause lag :( )
            keyA.drum.tap(don);
            // setTimeout(() => {
            //   keyA.pressed = false;
            // }, 100)
      }
      //okay this references notes, drum, combo, spirit gauge, and score
      let notesKeys = Object.keys(notes);
      console.log(notesKeys);
      for (let i = 0; i < notesKeys.length; i++) {
        let id = notesKeys[i];
        let note = notes[id];
        if (note.x > drum.x - 60 && note.x < drum.x) {
          for (let j = 0; j < drumKeys.length; j++) {
            let key = drumKeys[j];
            if (key.pressed) {
              key.pressed = false;
              // drum.flash();
              if (key.type === note.type) {
                combo.up();
                spiritGauge.up(combo.combo);
                score.up(spiritGauge.spirit);
                delete notes[id];
              } else {
                console.log("miss")
                combo.reset();
              }
            }
          }
        }
        if (note.x > drum.x){
          break;
        }
      }
  }

  function onMouseUp(e) {
      // Get the mouse position
      // console.log("keyup",timer, keyB.pressed,keyA.pressed)
  }
  function onTouchStart(e){
    e.clientX = e.touches[0].clientX;
    e.clientY = e.touches[0].clientY;
    // console.log("Touching",e.clientX,e.clientY)
    onMouseDown(e);
  }
  function onTouchEnd(e){
      // console.log("Touch ended");
      onMouseUp(e);
  }
  canvas.addEventListener("mousedown", onMouseDown);
  canvas.addEventListener("touchstart", onTouchStart);
  canvas.addEventListener("touchend", onTouchEnd);
  canvas.addEventListener("mouseup", onMouseUp);
  startscreen.addEventListener("mousedown", () => {
        console.log('in local storage')
        canvas.style.display = "block";
        startscreen.style.display = "none";
        gameSelection = true;
        localStorage.setItem("arcadehit","true");
  });
  // startscreen.addEventListener("touchstart", onTouchStart);
  // startscreen.addEventListener("touchend", onTouchEnd);
  // startscreen.addEventListener("mouseup", onMouseUp);

  //gif code
  function onGifMouseDown(e) {
          gifs[0].style.display = 'none';
          // closebutton.style.display = 'none';
          // localStorage.setItem('gifnum',(gifnum + 1)%5);
  }
  // for (var i=0; i<5; i++){
  //   gifs[i].addEventListener("mousedown", onGifMouseDown)
  // }

  if (localStorage.getItem("selectedsong") !== null) {
    console.log(localStorage.getItem("selectedsong"));
    selectSong(localStorage.getItem("selectedsong"));
    localStorage.removeItem("selectedsong");
  }

  function selectSong(songname) {
      console.log(songname);
      selectedSong = songname;
      gameSelection = false;

      let music = songLib[songname];
      music.volume = 0.5;
      let clearTouch = false;
      let touchSetTime = 0;

      const toggleMusic = new ToggleMusic(music);
      const togglePlay = new TogglePlay();
      const stage = canvas.getContext('2d');
      score = new Score(songname);
      spiritGauge = new SpiritGauge();
      combo = new Combo();
      // drum = new Drum();
      taikoInseong = new TaikoInseong(songname);

       function togglePause() {
          console.log('toggling pause')
          if (!gameEnded && !gameSelection) {
            if (musicOn) {
              musicOn = false;
              pauseStart = Date.now();
              music.pause();
            } else {
              musicOn = true;
              // console.log(pauseStart);
              // console.log(timePaused);
              timePaused = Math.ceil(Date.now()-pauseStart)+timePaused;
              // console.log(timePaused)
              music.play();
            }
            togglePlay.render();
        
            gameOn = gameOn ? false : true;
            update();
          }
        }

      function setupStage() {
        // NotesArea();
        canvas.style.backgroundImage = `url("./gifs/${songname}/background.png")`;
        drum.render();
        score.render();
        // spiritGauge.render();
        combo.render();
      }
      setupStage();

      let musicOn //gameOn, gameEnded;
      let pauseStart = Date.now();
      let timePaused = 0;
      let msg = document.getElementById('msg');
      let restart = document.getElementById('restart');
      // let modal = document.querySelector('.modal');
      let playPause = document.querySelector('.play-pause');

      playPause.addEventListener('click', () => togglePause());
      restart.addEventListener('click', () => {
          localStorage.setItem('selectedsong',selectedSong)
          location.reload();
      });
      // modal.addEventListener('click', () => {
      //   if (!gameEnded) {
      //     togglePause();
      //     modal.classList.add('hide');
      //   }
      // })

      document.addEventListener('keydown', e => {
        if (e.code === 'Space' && !gameEnded) {
          togglePause();
          // modal.classList.add('hide');
        }
        if (e.code === 'KeyR') {
          location.reload();
        }
      });

      music.onended = () => gameOver(true);

      function gameOver(win) {
        gameEnded = true;
        gameOn = false;
        music.pause();
        // numimage = new Image();
        // numimage.src = `./gifs/numbers.png`;
        if (win) {
          console.log('win')
          stage.clearRect(0, 0, 800, 500);
          canvas.style.backgroundImage = `url("./gifs/win.png")`;
          for (let i=0; i<score.scorestring.length; i++) {
            let num = parseInt(score.scorestring.charAt(i));
            stage.drawImage(score.numimage, num * 40, 0, 40, 40, 368+ 25*i, 295, 25, 25);
          }
          let gifnum = songid.indexOf(songname);
          gifs[0].style.display = 'inline-block';
          giftag = gifs[0].getElementsByTagName('img')[0];
          let height = document.documentElement.clientHeight/1.90 - giftag.height/2;
          gifs[0].style.top = `${height}px`;
          let wid = document.documentElement.clientWidth/2 - giftag.width/2;
          gifs[0].style.left = `${wid}px`;
        } else {
          console.log('lost')
          stage.clearRect(0, 0, 800, 500);
          canvas.style.backgroundImage = `url("./gifs/lose.png")`;
        }
      }

      let frames = 0;
      let vel = 4;
      // let life = music.bpm / 10;
      let life = 2;
      let startTime = 0;
      let latestNote = songNotes[songname][0];
      let latestNoteIndex = 0;
      let timer = 0;
      let last_note = false;

      function update() {
        if (life<=0) gameOver(true);
        if (gameEnded || !gameOn) {
          return;
        }

        stage.clearRect(0, 0, 800, 500);
        frames ++;

        setupStage();

        let bpm = music.bpm;
        // let delay = Math.floor(3600 / bpm - Math.random() * vel / 2);
        if(!startTime){
          startTime = Date.now();
          timePaused = 0

        }else{
          timer = Math.ceil(Date.now() - startTime-timePaused);
          // console.log(timer, timePaused)
        }
        taikoInseong.render();
        if (taikoInseong.state != "neutral" && taikoInseong.updateTimer > timer-200){
          taikoInseong.updateState("neutral",timer);
        }
        // console.log(latestNote,songNotes[songname].length-1,latestNoteIndex)
        if (timer>latestNote[0]+2000 && last_note === true){
          gameOver();
        }
        let notesKeys = Object.keys(notes);
        if (latestNoteIndex >= songNotes[songname].length-2){
          last_note = true;
        } else {
              if(timer + time_on_screen >= latestNote[0]){
                let type = (latestNote[2] === "2" || latestNote[2] ==="1") ? 'don' : 'kat';
                let color = (latestNote[2] === "2" || latestNote[2] === "1") ? 'pink' : 'blue';
                let note = new Note(vel,color, type,latestNote[0]);
                notes[note.id] = note;
                latestNoteIndex += 1;
                latestNote = songNotes[songname][latestNoteIndex+1];
              }
        }
        for (let i = 0; i < notesKeys.length; i++) {
          let id = notesKeys[i];
          let note = notes[id];
          note.render();
          note.move(timer);

          if (note.x > drum.x - 60 && note.x < drum.x) {
            taikoInseong.updateState((note.color == 'pink') ? 'left' : 'right',timer)
          } 
          if (note.x < 40) {
            spiritGauge.down();
            combo.reset();
            delete notes[id];
            life--;
          }
        }
        keyA.pressed = false;
        keyB.pressed = false;

        requestAnimationFrame(update);
      }
      togglePause();
  }
  });